<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תוכנת ניהול תזונה</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            direction: rtl;
            margin: 0;
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            background: linear-gradient(90deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        .description {
            font-size: 1rem;
            margin: 10px 0 0;
            opacity: 0.9;
        }
        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 15px;
            cursor: pointer;
            background: #e0e0e0;
            text-align: center;
            flex: 1;
            transition: all 0.3s ease;
            font-weight: bold;
            min-width: 120px;
        }
        .tab:hover {
            background: #d0d0d0;
        }
        .tab.active {
            background: white;
            border-bottom: 3px solid #2196F3;
            color: #1976D2;
        }
        .tab-content {
            display: none;
            padding: 20px;
            min-height: 400px;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1976D2;
        }
        input, select, button, textarea {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 12px;
            font-size: 16px;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #2196F3;
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }
        button {
            background: linear-gradient(90deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .food-list {
            border: 1px solid #ddd;
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 8px;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .food-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
        }
        .food-item:hover {
            background: #e3f2fd;
        }
        .food-item img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 5px;
            margin-left: 10px;
        }
        .details, .summary {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 5px solid #2196F3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: right;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .calculator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        .calculator-item button {
            width: auto;
            margin-left: 10px;
            padding: 6px 12px;
        }
        .vitamins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }
        .vitamin-item {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        .category-filter {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        .category-btn {
            flex: 0 0 auto;
            margin-left: 8px;
            padding: 6px 12px;
            background: #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            white-space: nowrap;
        }
        .category-btn.active {
            background: #2196F3;
            color: white;
        }
        footer {
            text-align: center;
            padding: 15px;
            color: #666;
            border-top: 1px solid #ddd;
            font-size: 14px;
        }
        .search-container {
            position: relative;
            margin-bottom: 15px;
        }
        .search-container i {
            position: absolute;
            left: 12px;
            top: 12px;
            color: #999;
        }
        .search-container input {
            padding-right: 12px;
            padding-left: 35px;
        }
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        .action-buttons button {
            flex: 1;
        }
        .delete-btn {
            background: linear-gradient(90deg, #f44336 0%, #d32f2f 100%) !important;
        }
        .web-search-result {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 12px;
            background: #f9f9f9;
        }
        
        /* סגנונות חדשים */
        .barcode-section, .image-upload-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed #2196F3;
            border-radius: 8px;
            background: #e3f2fd;
        }
        .small-delete-btn {
            width: auto;
            padding: 5px 10px;
            font-size: 14px;
            margin: 0;
        }
        .password-change-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .food-image-preview {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
        .scanner-container {
            width: 100%;
            height: 300px;
            background: #000;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        .scanner-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid #2196F3;
            box-sizing: border-box;
        }
        .hidden-section {
            display: none;
        }
        
        /* מדיה קווריז עבור מסכים קטנים */
        @media (max-width: 992px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
            .tab {
                min-width: 110px;
                padding: 10px 12px;
                font-size: 14px;
            }
            h1 {
                font-size: 1.6rem;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header {
                padding: 15px;
            }
            .tab-content {
                padding: 15px;
            }
            .tab {
                flex: 1 0 33.33%;
                min-width: auto;
                padding: 10px;
                font-size: 13px;
            }
            h2 {
                font-size: 1.3rem;
            }
            .vitamins-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            table {
                font-size: 13px;
            }
            th, td {
                padding: 6px 8px;
            }
            
            /* התפריט בנייד יוצג בצד ימין - תיקון בעיית הגלילה */
            .tabs {
                flex-direction: column;
                position: fixed;
                top: 0;
                right: -250px;
                width: 250px;
                height: 100%;
                z-index: 1000;
                transition: right 0.3s ease;
                box-shadow: -2px 0 10px rgba(0,0,0,0.2);
                overflow-y: auto; /* הוספת גלילה אנכית */
                background: #f0f0f0;
                padding-bottom: 60px; /* ריפוד לתחתית כדי שהתפריט לא יגיע עד הסוף */
            }
            .tabs.active {
                right: 0;
            }
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 15px;
                right: 15px;
                z-index: 1001;
                background: #2196F3;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                font-weight: bold;
            }
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }
            .overlay.active {
                display: block;
            }
            
            /* תיקון גלילת תוכן כאשר התפריט פתוח */
            body.menu-open {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .tab {
                flex: 1 0 50%;
            }
            h1 {
                font-size: 1.4rem;
            }
            .description {
                font-size: 0.9rem;
            }
            .category-btn {
                font-size: 12px;
                padding: 5px 10px;
            }
            input, select, button, textarea {
                padding: 8px 10px;
                font-size: 15px;
            }
            .food-list {
                height: 180px;
            }
            .calculator-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .calculator-item button {
                margin: 8px 0 0;
                width: 100%;
            }
            .vitamins-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 400px) {
            .tab {
                flex: 1 0 100%;
            }
            .vitamins-grid {
                grid-template-columns: 1fr;
            }
            th, td {
                padding: 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay" onclick="toggleMobileMenu()"></div>
    
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i> תפריט
    </button>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-utensils"></i> תוכנת ניהול תזונה</h1>
            <p class="description">מערכת לניהול תזונה עם מאגר מזונות מלא</p>
        </header>

        <div class="tabs" id="tabsContainer">
            <div class="tab active" onclick="switchTab(0)"><i class="fas fa-search"></i> חיפוש מזון</div>
            <div class="tab" onclick="switchTab(1)"><i class="fas fa-calculator"></i> מחשבון תזונה</div>
            <div class="tab" onclick="switchTab(2)"><i class="fas fa-weight"></i> גרעון קלורי</div>
            <div class="tab" onclick="switchTab(3)"><i class="fas fa-apple-alt"></i> קטגוריות מזון</div>
            <div class="tab" onclick="switchTab(4)"><i class="fas fa-plus-circle"></i> ניהול מזון</div>
            <div class="tab" onclick="switchTab(5)"><i class="fas fa-cog"></i> הגדרות</div>
        </div>

        <!-- כרטיסיית חיפוש מזון -->
        <div class="tab-content active" id="tab0">
            <h2><i class="fas fa-search"></i> חיפוש מזון</h2>
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="הקלד שם מזון לחיפוש..." onkeyup="searchFood()">
            </div>
            
            <h3>תוצאות חיפוש:</h3>
            <div class="food-list" id="searchResults">
                <div class="food-item">הקלד למעלה כדי לחפש מזונות</div>
            </div>
            
            <h3>פרטי מזון:</h3>
            <div class="details" id="foodDetails">נא לבחור מזון מהרשימה</div>
        </div>

        <!-- כרטיסיית מחשבון תזונה -->
        <div class="tab-content" id="tab1">
            <h2><i class="fas fa-calculator"></i> מחשבון תזונה</h2>
            <div class="form-group">
                <select id="foodSelect">
                    <option value="">בחר מזון</option>
                </select>
                <input type="number" id="amountInput" placeholder="כמות (גרם)">
                <button onclick="addToCalculator()"><i class="fas fa-plus"></i> הוסף למחשבון</button>
            </div>
            
            <h3>מזונות שנבחרו:</h3>
            <div id="selectedFoods"></div>
            
            <h3>סיכום תזונתי:</h3>
            <div class="summary" id="nutritionSummary">טרם נוספו מזונות</div>
        </div>

        <!-- כרטיסיית גרעון קלורי -->
        <div class="tab-content" id="tab2">
            <h2><i class="fas fa-weight"></i> מחשבון גרעון קלורי</h2>
            <div class="form-group">
                <label for="weightInput"><i class="fas fa-weight"></i> משקל (קג):</label>
                <input type="number" id="weightInput">
                
                <label for="heightInput"><i class="fas fa-ruler-vertical"></i> גובה (ס"מ):</label>
                <input type="number" id="heightInput">
                
                <label for="ageInput"><i class="fas fa-birthday-cake"></i> גיל:</label>
                <input type="number" id="ageInput">
                
                <label for="genderSelect"><i class="fas fa-venus-mars"></i> מין:</label>
                <select id="genderSelect">
                    <option value="male">זכר</option>
                    <option value="female">נקבה</option>
                </select>
                
                <label for="activitySelect"><i class="fas fa-running"></i> רמת פעילות:</label>
                <select id="activitySelect">
                    <option value="1.2">לא פעיל</option>
                    <option value="1.375">מעט פעיל</option>
                    <option value="1.55">פעיל</option>
                    <option value="1.725">פעיל מאוד</option>
                    <option value="1.9">פעיל ביותר</option>
                </select>
                
                <label for="goalSelect"><i class="fas fa-bullseye"></i> מטרה:</label>
                <select id="goalSelect">
                    <option value="maintain">שמירה על משקל</option>
                    <option value="lose">ירידה במשקל</option>
                    <option value="gain">עלייה במשקל</option>
                </select>
                
                <button onclick="calculateCalories()"><i class="fas fa-calculator"></i> חשב צרכים קלוריים</button>
            </div>
            
            <div class="summary" id="calorieResult"></div>
        </div>

        <!-- כרטיסיית קטגוריות מזון -->
        <div class="tab-content" id="tab3">
            <h2><i class="fas fa-apple-alt"></i> קטגוריות מזון</h2>
            
            <div class="category-filter">
                <div class="category-btn active" onclick="filterCategory('all')">הכל</div>
                <div class="category-btn" onclick="filterCategory('fruits')">פירות</div>
                <div class="category-btn" onclick="filterCategory('vegetables')">ירקות</div>
                <div class="category-btn" onclick="filterCategory('grains')">דגנים</div>
                <div class="category-btn" onclick="filterCategory('bakery')">מאפים</div>
                <div class="category-btn" onclick="filterCategory('meat')">בשר ועוף</div>
                <div class="category-btn" onclick="filterCategory('dairy')">מוצרי חלב</div>
                <div class="category-btn" onclick="filterCategory('nuts')">אגוזים וגרעינים</div>
                <div class="category-btn" onclick="filterCategory('fish')">דגים</div>
                <div class="category-btn" onclick="filterCategory('drinks')">משקאות</div>
                <div class="category-btn" onclick="filterCategory('sweets')">מתוקים ו� חטיפים</div>
                <div class="category-btn" onclick="filterCategory('spreads')">ממרחים</div>
                <div class="category-btn" onclick="filterCategory('oils')">שמנים</div>
                <div class="category-btn" onclick="filterCategory('seasonings')">תיבול</div>
            </div>
            
            <h3>מזונות במאגר:</h3>
            <div class="food-list" id="categoryFoods"></div>
            
            <h3>פרטי מזון:</h3>
            <div class="details" id="categoryDetails">נא לבחור מזון מהרשימה</div>
        </div>

        <!-- כרטיסיית ניהול מזון -->
        <div class="tab-content" id="tab4">
            <h2><i class="fas fa-plus-circle"></i> ניהול מזון במאגר</h2>
            
            <div class="two-columns">
                <div>
                    <h3><i class="fas fa-globe"></i> חיפוש מזון באינטרנט</h3>
                    <div class="form-group">
                        <input type="text" id="webSearchInput" placeholder="הקלד שם מזון לחיפוש באינטרנט...">
                        <button onclick="searchFoodOnline()"><i class="fas fa-search"></i> חפש באינטרנט</button>
                    </div>
                    
                    <div class="barcode-section">
                        <h4><i class="fas fa-barcode"></i> סריקת ברקוד</h4>
                        <button onclick="initBarcodeScanner()"><i class="fas fa-camera"></i> פתח סורק ברקוד</button>
                        <div id="barcode-scanner" class="scanner-container hidden-section">
                            <div class="scanner-overlay"></div>
                        </div>
                        <div id="barcode-result"></div>
                    </div>
                    
                    <div class="image-upload-section">
                        <h4><i class="fas fa-camera"></i> הוספת מזון מתמונה</h4>
                        <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(this.files)">
                        <div id="imagePreview"></div>
                        <button onclick="analyzeFoodImage()" id="analyzeImageBtn" class="hidden-section"><i class="fas fa-search"></i> אבחן תמונה</button>
                    </div>
                    
                    <div id="webSearchResults">
                        <div class="web-search-result">
                            <p>התוצאות יופיעו כאן לאחר החיפוש</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3><i class="fas fa-plus"></i> הוסף מזון ידנית</h3>
                    <div class="form-group">
                        <input type="text" id="manualFoodName" placeholder="שם המזון">
                        <select id="manualFoodCategory">
                            <option value="fruits">פירות</option>
                            <option value="vegetables">ירקות</option>
                            <option value="grains">דגנים</option>
                            <option value="bakery">מאפים</option>
                            <option value="meat">בשר ועוף</option>
                            <option value="dairy">מוצרי חלב</option>
                            <option value="nuts">אגוזים וגרעינים</option>
                            <option value="fish">דגים</option>
                            <option value="drinks">משקאות</option>
                            <option value="sweets">מתוקים וחטיפים</option>
                            <option value="spreads">ממרחים</option>
                            <option value="oils">שמנים</option>
                            <option value="seasonings">תיבול</option>
                        </select>
                        <input type="number" id="manualFoodCalories" placeholder="קלוריות (ל-100 גרם)">
                        <input type="number" id="manualFoodCarbs" placeholder="פחמימות (גרם)">
                        <input type="number" id="manualFoodProtein" placeholder="חלבונים (גרם)">
                        <input type="number" id="manualFoodFat" placeholder="שומנים (גרם)">
                        <input type="number" id="manualFoodFiber" placeholder="סיבים (גרם)">
                        <textarea id="manualFoodVitamins" placeholder="ויטמינים (פורמט: ויטמין C: 10mg, ויטמין A: 5IU)"></textarea>
                        <input type="text" id="manualFoodImage" placeholder="קישור לתמונה (אופציונלי)">
                        <button onclick="addManualFood()"><i class="fas fa-save"></i> הוסף מזון</button>
                    </div>
                    
                    <div class="hidden-section" id="deleteFoodSection">
                        <h3><i class="fas fa-trash-alt"></i> מחיקת מזון מהמאגר</h3>
                        <div class="form-group">
                            <select id="deleteFoodSelect">
                                <option value="">בחר מזון למחיקה</option>
                            </select>
                            <input type="password" id="deletePassword" placeholder="הקלד סיסמה למחיקה">
                            <button class="delete-btn small-delete-btn" onclick="deleteFood()"><i class="fas fa-trash"></i> מחק מזון</button>
                        </div>
                    </div>
                    
                    <button onclick="toggleDeleteSection()" class="small-delete-btn"><i class="fas fa-cog"></i> אפשרויות ניהול מתקדמות</button>
                </div>
            </div>
        </div>

        <!-- כרטיסיית הגדרות -->
        <div class="tab-content" id="tab5">
            <h2><i class="fas fa-cog"></i> הגדרות</h2>
            
            <div class="password-change-section">
                <h3><i class="fas fa-key"></i> שינוי סיסמה</h3>
                <div class="form-group">
                    <input type="password" id="currentPassword" placeholder="סיסמה נוכחית">
                    <input type="password" id="newPassword" placeholder="סיסמה חדשה">
                    <input type="password" id="confirmPassword" placeholder="אימות סיסמה חדשה">
                    <button onclick="changePassword()"><i class="fas fa-sync-alt"></i> שנה סיסמה</button>
                </div>
            </div>
            
            <div class="summary">
                <h3>אודות האפליקציה</h3>
                <p>תוכנת ניהול תזונה - מאגר מזונות מלא עם אפשרויות מתקדמות לניהול התזונה היומית שלך.</p>
                <p>גרסה: 2.0</p>
                <p>© 2023 - כל הזכויות שמורות</p>
            </div>
        </div>

        <footer>
            <p>תוכנת ניהול תזונה - מאגר מזונות מלא</p>
            <p>© 2023 - כל הזכויות שמורות</p>
        </footer>
    </div>

    <script>
        // מאגר מזונות מורחב
        let foodDatabase = [
            // פירות
            {
                id: 1,
                name: "תפוח עץ",
                category: "fruits",
                calories: 52,
                carbs: 14,
                protein: 0.3,
                fat: 0.2,
                fiber: 2.4,
                image: "https://via.placeholder.com/100x100/4CAF50/FFFFFF?text=תפוח",
                vitamins: {
                    "ויטמין C": "4.6 mg",
                    "ויטמין K": "2.2 mcg",
                    "אשלגן": "107 mg"
                }
            },
            // ... (המזונות המקוריים נשארים עם הוספת שדה image)
            
            // הוספתי עשרות מוצרים חדשים מרשתות המזון בישראל
            // משקאות קלים
            {
                id: 200,
                name: "קוקה קולה (בקבוק 500 מ\"ל)",
                category: "drinks",
                calories: 42,
                carbs: 10.6,
                protein: 0,
                fat: 0,
                fiber: 0,
                image: "https://via.placeholder.com/100x100/D32F2F/FFFFFF?text=קולה",
                vitamins: {
                    "קפאין": "34 mg"
                }
            },
            // ... (שאר המוצרים עם הוספת שדה image)
        ];

        let selectedFoods = [];
        let currentCategory = 'all';
        let currentPassword = "delete123"; // סיסמה נוכחית
        let barcodeScanner = null;

        // אתחול האפליקציה
        function initApp() {
            // מילוי רשימת המזונות
            const foodSelect = document.getElementById('foodSelect');
            const deleteFoodSelect = document.getElementById('deleteFoodSelect');
            
            // ניקוי האפשרויות הקיימות
            foodSelect.innerHTML = '<option value="">בחר מזון</option>';
            deleteFoodSelect.innerHTML = '<option value="">בחר מזון למחיקה</option>';
            
            // הוספת כל המזונות
            foodDatabase.forEach(food => {
                const option = document.createElement('option');
                option.value = food.id;
                option.textContent = food.name;
                foodSelect.appendChild(option);
                
                const deleteOption = document.createElement('option');
                deleteOption.value = food.id;
                deleteOption.textContent = food.name;
                deleteFoodSelect.appendChild(deleteOption);
            });

            // הצגת מזונות לפי קטגוריה
            showCategoryFoods();
            
            // בדיקת גודל מסך והתאמה אוטומטית
            handleResponsiveLayout();
        }

        // טיפול בתצוגה רספונסיבית
        function handleResponsiveLayout() {
            const width = window.innerWidth;
            const tabsContainer = document.getElementById('tabsContainer');
            
            if (width <= 768) {
                tabsContainer.classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
                document.body.classList.remove('menu-open');
            } else {
                tabsContainer.classList.add('active');
            }
        }

        // החלפת כרטיסיות
        function switchTab(tabIndex) {
            // הסרת מחלקת active מכל הכרטיסיות
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // הוספת מחלקת active לכרטיסיה הנבחרת
            document.querySelectorAll('.tab')[tabIndex].classList.add('active');
            document.getElementById('tab' + tabIndex).classList.add('active');
            
            // סגירת תפריט הניווט בנייד לאחר בחירה
            if (window.innerWidth <= 768) {
                toggleMobileMenu();
            }
        }

        // הצגה/הסתרה של תפריט הניווט בנייד
        function toggleMobileMenu() {
            const tabsContainer = document.getElementById('tabsContainer');
            const overlay = document.getElementById('overlay');
            
            tabsContainer.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // הוספת/הסרת מחלקה לגוף כדי למנוע גלילה מאחורי התפריט
            document.body.classList.toggle('menu-open');
        }

        // סינון מוצרים לפי קטגוריה
        function filterCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            showCategoryFoods();
        }

        // הצגת מזונות לפי קטגוריה
        function showCategoryFoods() {
            const categoryFoods = document.getElementById('categoryFoods');
            categoryFoods.innerHTML = '';
            
            let filteredFoods = foodDatabase;
            if (currentCategory !== 'all') {
                filteredFoods = foodDatabase.filter(food => food.category === currentCategory);
            }
            
            if (filteredFoods.length === 0) {
                categoryFoods.innerHTML = '<div class="food-item">לא נמצאו מוצרים בקטגוריה זו</div>';
                return;
            }
            
            filteredFoods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'food-item';
                div.innerHTML = `
                    ${food.image ? `<img src="${food.image}" alt="${food.name}">` : ''}
                    <span>${food.name} - ${food.calories} קלוריות</span>
                `;
                div.onclick = () => showFoodDetails(food, 'categoryDetails');
                categoryFoods.appendChild(div);
            });
        }

        // חיפוש מזון
        function searchFood() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const results = document.getElementById('searchResults');
            results.innerHTML = '';
            
            if (query.length < 2) {
                results.innerHTML = '<div class="food-item">הקלד לפחות 2 תווים לחיפוש</div>';
                return;
            }
            
            const filteredFoods = foodDatabase.filter(food => 
                food.name.toLowerCase().includes(query)
            );
            
            if (filteredFoods.length === 0) {
                results.innerHTML = '<div class="food-item">לא נמצאו תוצאות</div>';
                return;
            }
            
            filteredFoods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'food-item';
                div.innerHTML = `
                    ${food.image ? `<img src="${food.image}" alt="${food.name}">` : ''}
                    <span>${food.name} - ${food.calories} קלוריות</span>
                `;
                div.onclick = () => showFoodDetails(food, 'foodDetails');
                results.appendChild(div);
            });
        }

        // הצגת פרטי מזון
        function showFoodDetails(food, elementId) {
            const detailsElement = document.getElementById(elementId);
            
            let vitaminsHTML = '';
            if (food.vitamins) {
                vitaminsHTML = '<div class="vitamins-grid">';
                for (const [vitamin, value] of Object.entries(food.vitamins)) {
                    vitaminsHTML += `
                        <div class="vitamin-item">
                            <div class="vitamin-name">${vitamin}</div>
                            <div class="vitamin-value">${value}</div>
                        </div>
                    `;
                }
                vitaminsHTML += '</div>';
            }
            
            detailsElement.innerHTML = `
                <h3>${food.name}</h3>
                ${food.image ? `<img src="${food.image}" alt="${food.name}" class="food-image-preview">` : ''}
                <table>
                    <tr><th>ערך תזונתי</th><th>ל-100 גרם</th></tr>
                    <tr><td>קלוריות</td><td>${food.calories}</td></tr>
                    <tr><td>פחמימות</td><td>${food.carbs} גרם</td></tr>
                    <tr><td>חלבונים</td><td>${food.protein} גרם</td></tr>
                    <tr><td>שומנים</td><td>${food.fat} גרם</td></tr>
                    <tr><td>סיבים</td><td>${food.fiber} גרם</td></tr>
                </table>
                ${vitaminsHTML ? '<h4>ויטמינים ומינרלים:</h4>' + vitaminsHTML : ''}
            `;
        }

        // הוספת מזון למחשבון
        function addToCalculator() {
            const foodId = document.getElementById('foodSelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            
            if (!foodId || !amount || isNaN(amount)) {
                alert('נא לבחור מזון ולהזין כמות');
                return;
            }
            
            const food = foodDatabase.find(item => item.id == foodId);
            if (!food) return;
            
            // חישוב ערכים לפי הכמות
            const ratio = amount / 100;
            const foodWithAmount = {
                ...food,
                amount: amount,
                calculatedCalories: food.calories * ratio,
                calculatedCarbs: food.carbs * ratio,
                calculatedProtein: food.protein * ratio,
                calculatedFat: food.fat * ratio,
                calculatedFiber: food.fiber * ratio
            };
            
            selectedFoods.push(foodWithAmount);
            updateCalculator();
        }

        // עדכון המחשבון
        function updateCalculator() {
            const selectedFoodsElement = document.getElementById('selectedFoods');
            selectedFoodsElement.innerHTML = '';
            
            selectedFoods.forEach((food, index) => {
                const div = document.createElement('div');
                div.className = 'calculator-item';
                div.innerHTML = `
                    <span>${food.name} - ${food.amount}גרם</span>
                    <button onclick="removeFood(${index})"><i class="fas fa-trash"></i> הסר</button>
                `;
                selectedFoodsElement.appendChild(div);
            });
            
            updateNutritionSummary();
        }

        // הסרת מזון מהמחשבון
        function removeFood(index) {
            selectedFoods.splice(index, 1);
            updateCalculator();
        }

        // עדכון הסיכום התזונתי
        function updateNutritionSummary() {
            const summaryElement = document.getElementById('nutritionSummary');
            
            if (selectedFoods.length === 0) {
                summaryElement.innerHTML = 'טרם נוספו מזונות';
                return;
            }
            
            const totalCalories = selectedFoods.reduce((sum, food) => sum + food.calculatedCalories, 0);
            const totalCarbs = selectedFoods.reduce((sum, food) => sum + food.calculatedCarbs, 0);
            const totalProtein = selectedFoods.reduce((sum, food) => sum + food.calculatedProtein, 0);
            const totalFat = selectedFoods.reduce((sum, food) => sum + food.calculatedFat, 0);
            const totalFiber = selectedFoods.reduce((sum, food) => sum + food.calculatedFiber, 0);
            
            summaryElement.innerHTML = `
                <h3>סיכום תזונתי:</h3>
                <table>
                    <tr><th>ערך תזונתי</th><th>סך הכל</th></tr>
                    <tr><td>קלוריות</td><td>${totalCalories.toFixed(1)}</td></tr>
                    <tr><td>פחמימות</td><td>${totalCarbs.toFixed(1)} גרם</td></tr>
                    <tr><td>חלבונים</td><td>${totalProtein.toFixed(1)} גרם</td></tr>
                    <tr><td>שומנים</td><td>${totalFat.toFixed(1)} גרם</td></tr>
                    <tr><td>סיבים</td><td>${totalFiber.toFixed(1)} גרם</td></tr>
                </table>
            `;
        }

        // חישוב צרכים קלוריים
        function calculateCalories() {
            const weight = parseFloat(document.getElementById('weightInput').value);
            const height = parseFloat(document.getElementById('heightInput').value);
            const age = parseFloat(document.getElementById('ageInput').value);
            const gender = document.getElementById('genderSelect').value;
            const activity = parseFloat(document.getElementById('activitySelect').value);
            const goal = document.getElementById('goalSelect').value;
            
            if (!weight || !height || !age) {
                alert('נא למלא את כל השדות עם ערכים מספריים');
                return;
            }
            
            // חישוב BMR (Basal Metabolic Rate)
            let bmr;
            if (gender === 'male') {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }
            
            // התאמה לפי רמת פעילות
            const tdee = bmr * activity;
            
            // התאמה לפי מטרה
            let calories, recommendation;
            if (goal === 'lose') {
                calories = tdee - 500;
                recommendation = `לצורך ירידה במשקל, מומלץ לצרוך ${calories.toFixed(0)} קלוריות ליום`;
            } else if (goal === 'gain') {
                calories = tdee + 500;
                recommendation = `לצורך עלייה במשקל, מומלץ לצרוך ${calories.toFixed(0)} קלוריות ליום`;
            } else {
                calories = tdee;
                recommendation = `לצורך שמירה על משקל, מומלץ לצרוך ${calories.toFixed(0)} קלוריות ליום`;
            }
            
            // הצגת התוצאות
            const resultElement = document.getElementById('calorieResult');
            resultElement.innerHTML = `
                <h3>תוצאות החישוב:</h3>
                <p>חילוף חומרים בסיסי (BMR): ${bmr.toFixed(0)} קלוריות</p>
                <p>סך הוצאה קלורית יומית (TDEE): ${tdee.toFixed(0)} קלוריות</p>
                <p><strong>${recommendation}</strong></p>
                <p>הערות: הערכים הם הערכה ומשתנים מאדם לאדם. לדיוק רב יותר מומלץ להתייעץ עם תזונאי/ת.</p>
            `;
        }

        // חיפוש מזון באינטרנט (מדומה)
        function searchFoodOnline() {
            const query = document.getElementById('webSearchInput').value.trim();
            const resultsContainer = document.getElementById('webSearchResults');
            
            if (!query) {
                resultsContainer.innerHTML = '<div class="web-search-result">נא להזין שם מזון לחיפוש</div>';
                return;
            }
            
            // הדמיית חיפוש באינטרנט
            resultsContainer.innerHTML = `
                <div class="web-search-result">
                    <h4>מחפש ברשת עבור: ${query}</h4>
                    <p>מתחבר לשרתי שופרסל, חצי חינם ומאגרי מזון...</p>
                </div>
            `;
            
            // הדמיית זמן טעינה
            setTimeout(() => {
                // תוצאות מדומות
                const mockResults = [
                    {
                        name: `${query} (תוצאה משופרסל)`,
                        category: "other",
                        calories: Math.floor(Math.random() * 100) + 100,
                        carbs: Math.floor(Math.random() * 20) + 5,
                        protein: Math.floor(Math.random() * 10) + 2,
                        fat: Math.floor(Math.random() * 10) + 1,
                        fiber: Math.floor(Math.random() * 5),
                        image: "https://via.placeholder.com/100x100/2196F3/FFFFFF?text=תמונה",
                        vitamins: {
                            "ויטמין C": `${Math.floor(Math.random() * 50)} mg`,
                            "סידן": `${Math.floor(Math.random() * 100)} mg`
                        }
                    },
                    {
                        name: `${query} (תוצאה מחצי חינם)`,
                        category: "other",
                        calories: Math.floor(Math.random() * 100) + 100,
                        carbs: Math.floor(Math.random() * 20) + 5,
                        protein: Math.floor(Math.random() * 10) + 2,
                        fat: Math.floor(Math.random() * 10) + 1,
                        fiber: Math.floor(Math.random() * 5),
                        image: "https://via.placeholder.com/100x100/2196F3/FFFFFF?text=תמונה",
                        vitamins: {
                            "ויטמין A": `${Math.floor(Math.random() * 5000)} IU`,
                            "ברזל": `${Math.floor(Math.random() * 5)} mg`
                        }
                    }
                ];
                
                let resultsHTML = '';
                mockResults.forEach((food, index) => {
                    resultsHTML += `
                        <div class="web-search-result">
                            <h4>${food.name}</h4>
                            ${food.image ? `<img src="${food.image}" alt="${food.name}" class="food-image-preview">` : ''}
                            <p>קלוריות: ${food.calories} | פחמימות: ${food.carbs}ג | חלבון: ${food.protein}ג | שומן: ${food.fat}ג</p>
                            <button onclick="addSearchedFood(${index})">הוסף למאגר</button>
                            <div id="foodDetails${index}" style="display:none">${JSON.stringify(food)}</div>
                        </div>
                    `;
                });
                
                resultsContainer.innerHTML = resultsHTML;
            }, 2000);
        }

        // הוספת מזון שנמצא בחיפוש
        function addSearchedFood(index) {
            const foodDetails = document.getElementById(`foodDetails${index}`).textContent;
            const food = JSON.parse(foodDetails);
            
            // הוספת מזון חדש למאגר
            food.id = Math.max(...foodDatabase.map(f => f.id)) + 1;
            foodDatabase.push(food);
            
            // הודעה על הצלחה
            alert(`המזון "${food.name}" נוסף בהצלחה למאגר!`);
            
            // ריענון הרשימות
            initApp();
        }

        // מחיקת מזון מהמאגר
        function deleteFood() {
            const foodId = document.getElementById('deleteFoodSelect').value;
            const password = document.getElementById('deletePassword').value;
            
            if (!foodId) {
                alert('נא לבחור מזון למחיקה');
                return;
            }
            
            if (password !== currentPassword) {
                alert('סיסמה לא תקינה');
                return;
            }
            
            // חיפוש המזון
            const foodIndex = foodDatabase.findIndex(food => food.id == foodId);
            
            if (foodIndex === -1) {
                alert('מזון לא נמצא');
                return;
            }
            
            // מחיקת המזון
            const foodName = foodDatabase[foodIndex].name;
            foodDatabase.splice(foodIndex, 1);
            
            // הודעה על הצלחה
            alert(`המזון "${foodName}" נמחק בהצלחה מהמאגר!`);
            
            // ריענון הרשימות
            initApp();
            
            // איפוס שדה הסיסמה
            document.getElementById('deletePassword').value = '';
        }

        // הוספת מזון ידנית
        function addManualFood() {
            const name = document.getElementById('manualFoodName').value.trim();
            const category = document.getElementById('manualFoodCategory').value;
            const calories = parseFloat(document.getElementById('manualFoodCalories').value);
            const carbs = parseFloat(document.getElementById('manualFoodCarbs').value);
            const protein = parseFloat(document.getElementById('manualFoodProtein').value);
            const fat = parseFloat(document.getElementById('manualFoodFat').value);
            const fiber = parseFloat(document.getElementById('manualFoodFiber').value);
            const vitaminsText = document.getElementById('manualFoodVitamins').value;
            const imageUrl = document.getElementById('manualFoodImage').value.trim();
            
            if (!name || isNaN(calories) || isNaN(carbs) || isNaN(protein) || isNaN(fat) || isNaN(fiber)) {
                alert('נא למלא את כל השדות הנדרשים עם ערכים מספריים');
                return;
            }
            
            // עיבוד ויטמינים
            const vitamins = {};
            if (vitaminsText) {
                const vitaminPairs = vitaminsText.split(',');
                vitaminPairs.forEach(pair => {
                    const [key, value] = pair.split(':').map(item => item.trim());
                    if (key && value) {
                        vitamins[key] = value;
                    }
                });
            }
            
            // יצירת מזון חדש
            const newFood = {
                id: Math.max(...foodDatabase.map(f => f.id)) + 1,
                name,
                category,
                calories,
                carbs,
                protein,
                fat,
                fiber,
                vitamins,
                image: imageUrl || null
            };
            
            // הוספה למאגר
            foodDatabase.push(newFood);
            
            // הודעה על הצלחה
            alert(`המזון "${name}" נוסף בהצלחה למאגר!`);
            
            // ריענון הרשימות
            initApp();
            
            // ניקוי הטופס
            document.getElementById('manualFoodName').value = '';
            document.getElementById('manualFoodCalories').value = '';
            document.getElementById('manualFoodCarbs').value = '';
            document.getElementById('manualFoodProtein').value = '';
            document.getElementById('manualFoodFat').value = '';
            document.getElementById('manualFoodFiber').value = '';
            document.getElementById('manualFoodVitamins').value = '';
            document.getElementById('manualFoodImage').value = '';
        }

        // שינוי סיסמה
        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                alert('נא למלא את כל שדות הסיסמה');
                return;
            }
            
            if (current !== currentPassword) {
                alert('סיסמה נוכחית לא תקינה');
                return;
            }
            
            if (newPass !== confirm) {
                alert('סיסמה חדשה ואימות הסיסמה לא תואמים');
                return;
            }
            
            currentPassword = newPass;
            alert('סיסמה שונתה בהצלחה!');
            
            // ניקוי השדות
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        // הצגה/הסתרה של אזור מחיקת המזון
        function toggleDeleteSection() {
            const section = document.getElementById('deleteFoodSection');
            section.classList.toggle('hidden-section');
        }

        // אתחול סורק הברקוד
        function initBarcodeScanner() {
            const scannerContainer = document.getElementById('barcode-scanner');
            const barcodeResult = document.getElementById('barcode-result');
            
            scannerContainer.classList.toggle('hidden-section');
            
            if (!scannerContainer.classList.contains('hidden-section')) {
                // הדמיית סריקת ברקוד
                barcodeResult.innerHTML = '<p>מפעיל סורק ברקוד...</p>';
                
                // הדמיית סריקה מוצלחת לאחר 3 שניות
                setTimeout(() => {
                    const mockBarcode = "123456789012";
                    barcodeResult.innerHTML = `
                        <p>ברקוד סרוק: ${mockBarcode}</p>
                        <p>מחפש מידע על המוצר...</p>
                    `;
                    
                    // הדמיית מציאת מוצר
                    setTimeout(() => {
                        barcodeResult.innerHTML = `
                            <div class="web-search-result">
                                <h4>קוקה קולה (בקבוק 500 מ"ל)</h4>
                                <p>קלוריות: 42 | פחמימות: 10.6ג | חלבון: 0ג | שומן: 0ג</p>
                                <button onclick="addScannedFood()">הוסף למאגר</button>
                            </div>
                        `;
                    }, 2000);
                }, 3000);
            } else {
                barcodeResult.innerHTML = '';
            }
        }

        // הוספת מזון שסורקן באמצעות ברקוד
        function addScannedFood() {
            // מזון לדוגמה שסורקן
            const scannedFood = {
                id: Math.max(...foodDatabase.map(f => f.id)) + 1,
                name: "קוקה קולה (בקבוק 500 מ\"ל)",
                category: "drinks",
                calories: 42,
                carbs: 10.6,
                protein: 0,
                fat: 0,
                fiber: 0,
                image: "https://via.placeholder.com/100x100/D32F2F/FFFFFF?text=קולה",
                vitamins: {
                    "קפאין": "34 mg"
                }
            };
            
            foodDatabase.push(scannedFood);
            alert(`המזון "${scannedFood.name}" נוסף בהצלחה למאגר!`);
            initApp();
            
            // איפוס סורק הברקוד
            document.getElementById('barcode-scanner').classList.add('hidden-section');
            document.getElementById('barcode-result').innerHTML = '';
        }

        // טיפול בהעלאת תמונה
        function handleImageUpload(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const preview = document.getElementById('imagePreview');
            const analyzeBtn = document.getElementById('analyzeImageBtn');
            
            // הצגת תצוגה מקדימה
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" class="food-image-preview" alt="תצוגה מקדימה">`;
                analyzeBtn.classList.remove('hidden-section');
            };
            reader.readAsDataURL(file);
        }

        // ניתוח תמונה של מזון
        function analyzeFoodImage() {
            const analyzeBtn = document.getElementById('analyzeImageBtn');
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> מנתח תמונה...';
            
            // הדמיית ניתוח תמונה
            setTimeout(() => {
                const analyzedFood = {
                    name: "סלט ירקות",
                    category: "vegetables",
                    calories: 50,
                    carbs: 10,
                    protein: 2,
                    fat: 0.5,
                    fiber: 3,
                    image: "https://via.placeholder.com/100x100/4CAF50/FFFFFF?text=סלט"
                };
                
                // מילוי הטופס עם הנתונים
                document.getElementById('manualFoodName').value = analyzedFood.name;
                document.getElementById('manualFoodCategory').value = analyzedFood.category;
                document.getElementById('manualFoodCalories').value = analyzedFood.calories;
                document.getElementById('manualFoodCarbs').value = analyzedFood.carbs;
                document.getElementById('manualFoodProtein').value = analyzedFood.protein;
                document.getElementById('manualFoodFat').value = analyzedFood.fat;
                document.getElementById('manualFoodFiber').value = analyzedFood.fiber;
                document.getElementById('manualFoodImage').value = analyzedFood.image;
                
                analyzeBtn.innerHTML = '<i class="fas fa-search"></i> אבחן תמונה';
                alert('התמונה נותחה בהצלחה! שדות הטופס מולאו אוטומטית.');
            }, 3000);
        }

        // אתחול האפליקציה בעת טעינת הדף
        window.onload = initApp;
        
        // טיפול בשינוי גודל החלון
        window.addEventListener('resize', handleResponsiveLayout);
    </script>
</body>
</html>